/*
Deployment script for BND.Services.Security.OTP.Db

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "BND.Services.Security.OTP.Db"
:setvar DefaultFilePrefix "BND.Services.Security.OTP.Db"
:setvar DefaultDataPath "C:\Program Files\Microsoft SQL Server\MSSQL10_50.MSSQLSERVER\MSSQL\DATA\"
:setvar DefaultLogPath "C:\Program Files\Microsoft SQL Server\MSSQL10_50.MSSQLSERVER\MSSQL\DATA\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];


GO
PRINT N'Altering [otp]...';


GO
ALTER AUTHORIZATION
    ON SCHEMA::[otp]
    TO [dbo];


GO
PRINT N'Altering [otp].[Attempt]...';


GO
ALTER TABLE [otp].[Attempt] ALTER COLUMN [UserAgent] VARCHAR (512) NOT NULL;


GO
PRINT N'Creating Permission...';


GO
GRANT INSERT
    ON OBJECT::[otp].[Account] TO [Otp_Role];


GO
PRINT N'Creating Permission...';


GO
GRANT SELECT
    ON OBJECT::[otp].[Account] TO [Otp_Role];


GO
PRINT N'Creating Permission...';


GO
GRANT UPDATE
    ON OBJECT::[otp].[Account] TO [Otp_Role];


GO
PRINT N'Creating Permission...';


GO
GRANT DELETE
    ON OBJECT::[otp].[Attempt] TO [Otp_Role];


GO
PRINT N'Creating Permission...';


GO
GRANT INSERT
    ON OBJECT::[otp].[Attempt] TO [Otp_Role];


GO
PRINT N'Creating Permission...';


GO
GRANT SELECT
    ON OBJECT::[otp].[Attempt] TO [Otp_Role];


GO
PRINT N'Creating Permission...';


GO
GRANT UPDATE
    ON OBJECT::[otp].[Attempt] TO [Otp_Role];


GO
PRINT N'Creating Permission...';


GO
GRANT DELETE
    ON OBJECT::[otp].[EnumChannelType] TO [Otp_Role];


GO
PRINT N'Creating Permission...';


GO
GRANT INSERT
    ON OBJECT::[otp].[EnumChannelType] TO [Otp_Role];


GO
PRINT N'Creating Permission...';


GO
GRANT SELECT
    ON OBJECT::[otp].[EnumChannelType] TO [Otp_Role];


GO
PRINT N'Creating Permission...';


GO
GRANT UPDATE
    ON OBJECT::[otp].[EnumChannelType] TO [Otp_Role];


GO
PRINT N'Creating Permission...';


GO
GRANT DELETE
    ON OBJECT::[otp].[EnumStatus] TO [Otp_Role];


GO
PRINT N'Creating Permission...';


GO
GRANT INSERT
    ON OBJECT::[otp].[EnumStatus] TO [Otp_Role];


GO
PRINT N'Creating Permission...';


GO
GRANT SELECT
    ON OBJECT::[otp].[EnumStatus] TO [Otp_Role];


GO
PRINT N'Creating Permission...';


GO
GRANT UPDATE
    ON OBJECT::[otp].[EnumStatus] TO [Otp_Role];


GO
PRINT N'Creating Permission...';


GO
GRANT INSERT
    ON OBJECT::[otp].[Log] TO [Otp_Role];


GO
PRINT N'Creating Permission...';


GO
GRANT SELECT
    ON OBJECT::[otp].[Log] TO [Otp_Role];


GO
PRINT N'Creating Permission...';


GO
GRANT UPDATE
    ON OBJECT::[otp].[Log] TO [Otp_Role];


GO
PRINT N'Creating Permission...';


GO
GRANT INSERT
    ON OBJECT::[otp].[OneTimePassword] TO [Otp_Role];


GO
PRINT N'Creating Permission...';


GO
GRANT SELECT
    ON OBJECT::[otp].[OneTimePassword] TO [Otp_Role];


GO
PRINT N'Creating Permission...';


GO
GRANT UPDATE
    ON OBJECT::[otp].[OneTimePassword] TO [Otp_Role];


GO
PRINT N'Creating Permission...';


GO
GRANT DELETE
    ON OBJECT::[otp].[Setting] TO [Otp_Role];


GO
PRINT N'Creating Permission...';


GO
GRANT INSERT
    ON OBJECT::[otp].[Setting] TO [Otp_Role];


GO
PRINT N'Creating Permission...';


GO
GRANT SELECT
    ON OBJECT::[otp].[Setting] TO [Otp_Role];


GO
PRINT N'Creating Permission...';


GO
GRANT UPDATE
    ON OBJECT::[otp].[Setting] TO [Otp_Role];


GO
BEGIN /* REGION [ EnumChannelType ]*/
	DELETE FROM  [otp].[EnumChannelType]
	INSERT INTO [otp].[EnumChannelType](ChannelType, Name)Values
		('SMS','Short Message Service'),
		('EMAIL','e-Mail')
END

BEGIN /* REGION [ EnumStatus ]*/
	DELETE FROM  [otp].[EnumStatus]
	INSERT INTO [otp].[EnumStatus]([Status], [Description])Values
		('Pending','The code ready to use.'),
		('Expired','The code has expired.'),
		('Locked','The code is locked by entered wrong more than limitation.'),
		('Verified','The code is used.'),
		('Deleted','The code has been deleted by client or system.'),
		('Canceled','The code has been cancelled by system because client re-generate code again with same suid.')
END

BEGIN /* REGION [ Setting ]*/
	DELETE FROM  [otp].[Setting]
	INSERT INTO [otp].[Setting]([Key], [Value])Values
		('Expiration','900'),
		('RetryCount','3')
END

BEGIN /* REGION [ Account ]*/
	DELETE FROM  [otp].[Account]
	/*
	Raw ApiKey is 
	1phM4nLk14tefH8cntFJfuINtH0w_POg1zdKO9EPiu28TYjwLH0mOWzvcFiD0h3pPvf9wlhxhYk5hA6Ur0BHg8InK91GwhfCbW4kQU_6KkbKTb1H9gkOqTnFZxY4lPyl
	*/
	INSERT INTO [otp].[Account]([AccountId], [ApiKey], [Name], [IpAddress], [IsActive], [Description], [Salt], [Email])Values
		('5861F73F-CAD5-419D-96D4-56BD07211297','lLTHykjZ3oZ5ORx1ePayit2+orgbNxI8d5N3296EhT7lSawnoygnfjKbyQdTrxVFLlZ8AfDjn1OnW5Hy2oAgWg==', 'AccountTest', '192.168.1.69', 1, 'This is for testing', 'ALzIYz8BIgvLsk1q', 'Test@mail.com')
		
END
GO

GO
PRINT N'Update complete.';


GO
